import{c as V,S as y,H as w,v as F,m as re,a as se,G as ie,f as oe,s as ae,i as U,D as M,b as C,d as ue,e as G,g as ce,h as le,j as q,M as H,k as de,l as pe,n as me,o as he,p as fe,q as Ie,r as ge,t as ye,u as we,I as Te,w as ve,x as xe,y as De,z as I,A as Ee,B as l,C as Pe,E as Se,F as Ae,J as $,K as Ce,L as Le,N as Q,O as W,P as Y,Q as _,R as J,T as K,U as X,V as Z,W as Re,X as He,Y as Ue,Z as Me,_ as z,$ as Oe,a0 as R,a1 as be,a2 as Be,a3 as Ne,a4 as ze}from"./main.52b4df71.js";function Ve(r,e,n){return e in r?Object.defineProperty(r,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):r[e]=n,r}class S{constructor(e){Ve(this,"spec",void 0),this.spec={options:{},...e||{}}}id(e){return this.clone({id:e})}getId(){return this.spec.id}title(e){return this.clone({title:e,id:this.spec.id||V(e)})}getTitle(){return this.spec.title}child(e){return this.clone({child:e})}getChild(){return this.spec.child}component(e){return this.clone({component:e})}getComponent(){return this.spec.component}options(e){return this.clone({options:e})}getOptions(){return this.spec.options||{}}menuItems(e){return this.clone({menuItems:e})}getMenuItems(){return this.spec.menuItems}menuItemGroups(e){return this.clone({menuItemGroups:e})}getMenuItemGroups(){return this.spec.menuItemGroups}serialize(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{path:[]};const{id:n,title:o,child:a,options:s,component:i}=this.spec;if(!n)throw new y("`id` is required for `component` structure item",e.path,e.index).withHelpUrl(w.ID_REQUIRED);if(!i)throw new y("`component` is required for `component` structure item",e.path,e.index).withHelpUrl(w.ID_REQUIRED);return{id:F(n,e.path,e.index),title:o,type:"component",child:a,component:i,options:s||{},menuItems:(this.spec.menuItems||[]).map((t,u)=>re(t,u,e.path)),menuItemGroups:(this.spec.menuItemGroups||[]).map((t,u)=>se(t,u,e.path))}}clone(e){const n=new S;return n.spec={...this.spec,...e||{}},n}}function Fe(r,e,n){return e in r?Object.defineProperty(r,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):r[e]=n,r}const Ge=r=>r instanceof D?"ListBuilder":Ye(r)?"Promise":Array.isArray(r)?"array":typeof r,qe=r=>r.type==="listItem",$e=(r,e,n)=>(n.pane.items||[]).filter(Xe).some(s=>s.schemaType.name===e.type&&s._id===e.id)||ae(r,e,n),Qe=(r,e)=>{const a=(e.parent.items.filter(qe).find(s=>s.id===r)||{child:void 0}).child;return!a||typeof a!="function"?a:typeof a=="function"?a(r,e):a};function We(r,e,n){if(r instanceof E)return r.serialize({path:n,index:e});const o=r;if(o&&o.type==="divider")return r;if(!o||o.type!=="listItem"){const a=o&&o.type||Ge(o),s=a==="array"?" - did you forget to spread (...moreItems)?":"";throw new y('List items must be of type "listItem", got "'.concat(a,'"').concat(s),n,e).withHelpUrl(w.INVALID_LIST_ITEM)}return r}function Ye(r){return U(r)&&typeof r.then=="function"}class D extends ie{constructor(e,n){super(),this._context=e,Fe(this,"spec",void 0),this.spec=n||{},this.initialValueTemplatesSpecified=Boolean(n&&n.initialValueTemplates)}items(e){return this.clone({items:e})}getItems(){return this.spec.items}serialize(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{path:[]};const n=this.spec.id;if(typeof n!="string"||!n)throw new y("`id` is required for lists",e.path,e.index).withHelpUrl(w.ID_REQUIRED);const o=typeof this.spec.items=="undefined"?[]:this.spec.items;if(!Array.isArray(o))throw new y("`items` must be an array of items",e.path,e.index).withHelpUrl(w.LIST_ITEMS_MUST_BE_ARRAY);const a=(e.path||[]).concat(n),s=o.map((t,u)=>We(t,u,a)),i=s.filter((t,u)=>oe(s,{id:t.id},u+1));if(i.length>0){const t=i.map(c=>c.id).slice(0,5),u=i.length>5?"".concat(t.join(", "),"..."):t.join(", ");throw new y("List items with same ID found (".concat(u,")"),e.path,e.index).withHelpUrl(w.LIST_ITEM_IDS_MUST_BE_UNIQUE)}return{...super.serialize(e),type:"list",canHandleIntent:this.spec.canHandleIntent||$e,child:this.spec.child||Qe,items:s}}clone(e){const n=new D(this._context);return n.spec={...this.spec,...e||{}},n}}function _e(r,e,n){return e in r?Object.defineProperty(r,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):r[e]=n,r}class E{constructor(e,n){this._context=e,_e(this,"spec",void 0),this.spec=n||{}}id(e){return this.clone({id:e})}getId(){return this.spec.id}title(e){return this.clone({title:e,id:this.spec.id||V(e)})}getTitle(){return this.spec.title}icon(e){return this.clone({icon:e})}showIcon(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;return this.clone({displayOptions:{...this.spec.displayOptions||{},showIcon:e}})}getShowIcon(){return this.spec.displayOptions?this.spec.displayOptions.showIcon:void 0}getIcon(){return this.spec.icon}child(e){return this.clone({child:e})}getChild(){return this.spec.child}schemaType(e){return this.clone({schemaType:e})}getSchemaType(){return this.spec.schemaType}serialize(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{path:[]};const{id:n,title:o,child:a}=this.spec;if(typeof n!="string"||!n)throw new y("`id` is required for list items",e.path,e.index).withHelpUrl(w.ID_REQUIRED);if(!e.titleIsOptional&&(typeof o!="string"||!o))throw new y("`title` is required for list items",e.path,n).withHelpUrl(w.TITLE_REQUIRED);let s=this.spec.schemaType;if(typeof s=="string"){const u=this._context.schema.get(s);if(!u)throw new y('Could not find type "'.concat(s,'" in schema'),e.path,n).withHelpUrl(w.SCHEMA_TYPE_NOT_FOUND);s=u}const i={path:e.path.concat(n),hint:"child"};let t=a instanceof S||a instanceof M||a instanceof C||a instanceof D?a.serialize(i):a;if(typeof t=="function"){const u=t;t=(c,p)=>u(c,{...p,serializeOptions:i})}return{...this.spec,id:F(n,e.path,e.index),schemaType:s,child:t,title:o,type:"listItem"}}clone(e){const n=new E(this._context);return n.spec={...this.spec,...e||{}},n}}function Je(r,e,n){return e in r?Object.defineProperty(r,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):r[e]=n,r}const Ke=(r,e)=>n=>{const o=e.schemaType&&(typeof e.schemaType=="string"?e.schemaType:e.schemaType.name);return o?r.resolveDocumentNode({schemaType:o,documentId:n}):new C(r).id("documentEditor").documentId(n)};class O extends E{constructor(e,n){super(e,n),this._context=e,Je(this,"spec",void 0),this.spec=n||{}}serialize(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{path:[]};const n=super.serialize({...e,titleIsOptional:!0});if(!n.schemaType)throw new y("`schemaType` is required for document list items",e.path,e.index).withHelpUrl(w.SCHEMA_TYPE_REQUIRED);const o=n.child||Ke(this._context,n);return{...n,child:o,schemaType:n.schemaType,_id:n.id}}clone(e){const n=new O(this._context);return n.spec={...this.spec,...e||{}},n}}function Xe(r){return U(r)&&typeof r.schemaType!="undefined"&&typeof r._id=="string"}function Ze(r,e,n){return e in r?Object.defineProperty(r,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):r[e]=n,r}class L extends M{constructor(e,n){super(e),this._context=e,Ze(this,"spec",void 0),this.spec=n||{}}child(e){return this.cloneWithoutDefaultIntentHandler({child:e})}clone(e){const n=super.clone(e),o=new L(this._context);return o.spec={...this.spec,...n.getSpec(),...e||{}},o}cloneWithoutDefaultIntentHandler(e){const n=super.clone(e),o=new L(this._context),a=this.spec.canHandleIntent,i=a&&a.identity===ue?{canHandleIntent:void 0}:{};return o.spec={...n.getSpec(),...this.spec,...e||{},...i},o}}function je(r){const e=r.preview;return Boolean(e&&(e.prepare||e.select&&e.select.media))}const ke=["sanity.imageAsset","sanity.fileAsset"];function et(r){return ke.includes(r)}function tt(r){var e;return((e=r.type)===null||e===void 0?void 0:e.name)==="document"}function nt(r){return r.type==="list"}function rt(r){let{schema:e}=r;return e.getTypeNames().filter(n=>{const o=e.get(n);return o&&tt(o)}).filter(n=>!et(n))}function j(r){return rt(r).map(n=>k(r,n))}function k(r,e){const{schema:n}=r,o=n.get(e);if(!o)throw new Error('Schema type with name "'.concat(e,'" not found'));const a=o.title||G(e);return new E(r).id(e).title(a).schemaType(e).child((s,i)=>{const t=i.parent,u=nt(t)?t.items.find(p=>p.id===s):null;let c=ee(r,e);return u&&u.title&&(c=c.title(u.title)),c})}function ee(r,e){const{schema:n,resolveDocumentNode:o}=r,a=typeof e=="string"?e:e.schemaType,s=typeof a=="string"?a:a.name,i=typeof e=="string"?{schemaType:a}:e,t=n.get(s);if(!t)throw new Error('Schema type with name "'.concat(s,'" not found'));const u=t.title||G(s),c=je(t);return new L(r).id(i.id||s).title(i.title||u).filter("_type == $type").params({type:s}).schemaType(s).showIcons(c).defaultOrdering(ce.by).menuItemGroups(i.menuItemGroups||[{id:"sorting",title:"Sort"},{id:"layout",title:"Layout"},{id:"actions",title:"Actions"}]).child(i.child||(p=>o({schemaType:s,documentId:p}))).canHandleIntent(i.canHandleIntent||le).menuItems(i.menuItems||[...q(r,t),new H(r).group("layout").title("Compact view").icon(de).action("setLayout").params({layout:"default"}),new H(r).group("layout").title("Detailed view").icon(pe).action("setLayout").params({layout:"detail"})])}function st(r){return!r||typeof r=="string"?!1:Boolean(r.icon)}function it(r){const e=j(r);return new D(r).id("__root__").title("Content").items(e).showIcons(e.some(n=>st(n.getSchemaType())))}function ot(r){let{defaultDocumentNode:e,source:n}=r;const o={...n,getStructureBuilder:()=>a,resolveDocumentNode:s=>{let i=(e==null?void 0:e(a,s))||new C(o);return i.getId()||(i=i.id("documentEditor")),s.documentId&&(i=i.documentId(me(s.documentId))),i.schemaType(s.schemaType)}},a={defaults:()=>it(o),documentTypeList:function(){for(var s=arguments.length,i=new Array(s),t=0;t<s;t++)i[t]=arguments[t];return ee(o,...i)},documentTypeListItem:function(){for(var s=arguments.length,i=new Array(s),t=0;t<s;t++)i[t]=arguments[t];return k(o,...i)},documentTypeListItems:function(){for(var s=arguments.length,i=new Array(s),t=0;t<s;t++)i[t]=arguments[t];return j(o,...i)},document:function(){for(var s=arguments.length,i=new Array(s),t=0;t<s;t++)i[t]=arguments[t];return new C(o,...i)},documentWithInitialValueTemplate:function(){for(var s=arguments.length,i=new Array(s),t=0;t<s;t++)i[t]=arguments[t];return he(o,...i)},defaultDocument:o.resolveDocumentNode,list:function(){for(var s=arguments.length,i=new Array(s),t=0;t<s;t++)i[t]=arguments[t];return new D(o,...i)},listItem:function(){for(var s=arguments.length,i=new Array(s),t=0;t<s;t++)i[t]=arguments[t];return new E(o,...i)},menuItem:function(){for(var s=arguments.length,i=new Array(s),t=0;t<s;t++)i[t]=arguments[t];return new H(o,...i)},menuItemGroup:function(){for(var s=arguments.length,i=new Array(s),t=0;t<s;t++)i[t]=arguments[t];return new fe(o,...i)},menuItemsFromInitialValueTemplateItems:function(){for(var s=arguments.length,i=new Array(s),t=0;t<s;t++)i[t]=arguments[t];return Ie(o,...i)},documentList:function(){for(var s=arguments.length,i=new Array(s),t=0;t<s;t++)i[t]=arguments[t];return new M(o,...i)},documentListItem:function(){for(var s=arguments.length,i=new Array(s),t=0;t<s;t++)i[t]=arguments[t];return new O(o,...i)},orderingMenuItem:function(){for(var s=arguments.length,i=new Array(s),t=0;t<s;t++)i[t]=arguments[t];return ge(o,...i)},orderingMenuItemsForType:function(){for(var s=arguments.length,i=new Array(s),t=0;t<s;t++)i[t]=arguments[t];return q(o,...i)},editor:function(){for(var s=arguments.length,i=new Array(s),t=0;t<s;t++)i[t]=arguments[t];return ye(o,...i)},defaultInitialValueTemplateItems:function(){for(var s=arguments.length,i=new Array(s),t=0;t<s;t++)i[t]=arguments[t];return we(o,...i)},initialValueTemplateItem:(s,i)=>new Te(o,{id:s,parameters:i,templateId:s}),component:s=>ve.exports.isValidElementType(s)?new S().component(s):new S(s),divider:()=>({id:xe("__divider__"),type:"divider"}),view:De,context:o};return a}function at(r){let{defaultDocumentNode:e,structure:n,children:o}=r;const[a,s]=I.exports.useState(!1),i=Ee(),t=I.exports.useMemo(()=>ot({defaultDocumentNode:e,source:i}),[e,i]),u=I.exports.useMemo(()=>n?n(t,i):t.defaults(),[t,n,i]);return l(Pe.Provider,{value:I.exports.useMemo(()=>({features:{backButton:a,reviewChanges:!a,splitPanes:!a,splitViews:!a},layoutCollapsed:a,setLayoutCollapsed:s,rootPaneNode:u,structureContext:t.context}),[a,u,t.context]),children:o})}async function ut(r){const e=new Map,o=Se(u=>(c,p,m)=>{const f=c&&"".concat(Le(c),"-").concat(p.path.join("__")),h=f&&e.get(f);if(h)return h;const v=u(c,p,m);return f&&e.set(f,v),v}),a=[[{id:"__edit__".concat(r.params.id),params:{...Ae(r.params,["id"]),type:r.params.type},payload:r.payload}]];async function s(u){var c;let{currentId:p,flatIndex:m,intent:f,params:h,parent:v,path:g,payload:P,unresolvedPane:x,levelIndex:A,structureContext:b}=u;if(!x)return[];const{id:B,type:te,...N}=h,d=await o(x,{id:p,splitIndex:0,parent:v,path:g,index:m,params:{},payload:void 0,structureContext:b},m).pipe($()).toPromise();return d.type==="document"&&d.id===B?[{panes:[...g.slice(0,g.length-1).map(T=>[{id:T}]),[{id:B,params:N,payload:P}]],depthIndex:g.length,levelIndex:A}]:(c=d.canHandleIntent)!==null&&c!==void 0&&c.call(d,f,h,{pane:d,index:m})||d.type==="documentList"&&d.schemaTypeName===te&&d.options.filter==="_type == $type"?[{panes:[...g.map(T=>[{id:T}]),[{id:h.id,params:N,payload:P}]],depthIndex:g.length,levelIndex:A}]:d.type==="list"&&d.child&&d.items?(await Promise.all(d.items.map((T,ne)=>T.type==="divider"?Promise.resolve([]):s({currentId:T._id||T.id,flatIndex:m+1,intent:f,params:h,parent:d,path:[...g,T.id],payload:P,unresolvedPane:typeof d.child=="function"?Ce(d,"child"):d.child,levelIndex:ne,structureContext:b})))).flat():[]}const t=(await s({currentId:"root",flatIndex:0,levelIndex:0,intent:r.intent,params:r.params,parent:null,path:[],payload:r.payload,unresolvedPane:r.rootPaneNode,structureContext:r.structureContext})).sort((u,c)=>u.depthIndex===c.depthIndex?u.levelIndex-c.levelIndex:u.depthIndex-c.depthIndex)[0];return t?t.panes:a}function ct(r){let{panes:e}=r;const{navigate:n}=Q();return I.exports.useEffect(()=>{n({panes:e},{replace:!0})},[n,e]),l(W,{height:"fill",children:l(Y,{ms:300,children:_(J,{align:"center",direction:"column",height:"fill",justify:"center",children:[l(K,{muted:!0}),l(X,{marginTop:3,children:l(Z,{muted:!0,size:1,children:"Redirecting\u2026"})})]})})})}async function lt(r,e,n){if(e&&n)return{id:e,type:n};if(!e&&n)return{id:Re(),type:n};if(e&&!n){const o=await r.resolveTypeForDocument(e).pipe($()).toPromise();return{id:e,type:o}}throw new He({message:"Neither document `id` or `type` was provided when trying to resolve intent."})}function dt(r){let{intent:e,params:n={},payload:o}=r;const{rootPaneNode:a,structureContext:s}=Ue(),i=Me(),t=z(n),u=z(o),[c,p]=I.exports.useState(null),[m,f]=I.exports.useState(null),h=typeof t.id=="string"?t.id:void 0,v=typeof t.type=="string"?t.type:void 0;if(I.exports.useEffect(()=>{const g={current:!1};async function P(){const{id:x,type:A}=await lt(i,h,v);return ut({intent:e,params:{...t,id:x,type:A},payload:u,rootPaneNode:a,structureContext:s})}return P().then(x=>{g.current||p(x)}).catch(f),()=>{g.current=!0}},[i,h,e,t,u,a,s,v]),m)throw m;return c?l(ct,{panes:c}):l(W,{height:"fill",children:l(Y,{ms:300,children:_(J,{align:"center",direction:"column",height:"fill",justify:"center",children:[l(K,{muted:!0}),l(X,{marginTop:3,children:l(Z,{align:"center",muted:!0,size:1,children:"Loading\u2026"})})]})})})}const pt={};function ft(r){let{tool:{options:e}}=r;const{unstable_sources:n}=Oe(),[o]=n,{source:a,defaultDocumentNode:s,structure:i}=e||{},{state:t}=Q(),u=I.exports.useMemo(()=>{const m=typeof t.intent=="string"?t.intent:void 0,f=U(t.params)?t.params:pt,h=t.payload;return m?{intent:m,params:f,payload:h}:void 0},[t]);I.exports.useEffect(()=>(R([]),()=>R([])),[]);const[{error:c},p]=I.exports.useState({error:null});return c?l(be,{error:c}):l(Be,{onCatch:p,children:l(Ne,{name:a||o.name,children:l(at,{defaultDocumentNode:s,structure:i,children:u?l(dt,{...u}):l(ze,{onPaneChange:R})})})})}export{ft as default};
