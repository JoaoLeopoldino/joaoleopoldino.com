import{ah as se,ai as re,aj as ae,ak as oe,n as H,al as ie,am as G,an as ce,ac as ue,z as d,B as a,R as D,ao as $,Q as v,ap as le,aq as de,V as w,U as j,a8 as U,ar as me,P as pe,as as fe,T as he,at as ye,O as k,au as ge,Y as Ie,a6 as Te,a9 as Le,aa as xe,a7 as Re,av as Se,aw as B,ax as Pe,ay as ve,az as Ce,aA as _e,aB as be,aC as we,aD as je,aE as M,aF as F,aG as Ee,aH as Ae,aI as De,aJ as Fe,aK as Oe,aL as $e,aM as ke,aN as Be,aO as Me,aP as qe,aQ as Ne,A as We,aR as q,_ as He,a3 as Ge,ae as Ue,aS as Ve,aT as Ye}from"./main.52b4df71.js";import{P as ze}from"./PaneItem.e3c22508.js";const N=100,O=2e3,V={by:[{field:"_createdAt",direction:"desc"}]},Ke={};function Qe(e,t){return e._id?H(e._id):"item-".concat(t)}function Xe(e){return ie(e).map(t=>({...t.draft||t.published,hasPublished:!!t.published,hasDraft:!!t.draft}))}const Je=/\b_type\s*==\s*(['"].*?['"]|\$.*?(?:\s|$))|\B(['"].*?['"]|\$.*?(?:\s|$))\s*==\s*_type\b/;function Ze(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const n=e.match(Je);if(!n)return null;const s=(n[1]||n[2]).trim().replace(/^["']|["']$/g,"");if(s[0]==="$"){const o=s.slice(1),l=t[o];return typeof l=="string"?l:null}return s}function et(e){return/^_type\s*==\s*['"$]\w+['"]?\s*$/.test(e.trim())}function tt(e){return e.map(t=>[nt(t),(t.direction||"").toLowerCase()].map(n=>n.trim()).filter(Boolean).join(" ")).join(",")}function nt(e){return e.mapWith?"".concat(e.mapWith,"(").concat(e.field,")"):e.field}function st(e,t){const n=e.by.map(s=>{if(s.mapWith)return s;const o=rt(t,s.field);return o?ot(o,"datetime")?{...s,mapWith:"dateTime"}:o.jsonType==="string"?{...s,mapWith:"lower"}:s:s});return n.every((s,o)=>s===e.by[o])?e:{...e,by:n}}function rt(e,t){const n=se(t);let s=e;for(const o of n){if(!s)return;if(typeof o=="string"){s=at(s,o);continue}if(!(re(o)||ae(o))||s.jsonType!=="array")return;const[r,i]=s.of||[];if(i||!r)return;if(!oe(r)){s=r;continue}const[m,h]=r.to||[];if(h||!m)return;s=m}return s}function at(e,t){if(!("fields"in e))return;const n=e.fields.find(s=>s.name===t);return n?n.type:void 0}function ot(e,t){let n=e.type;for(;n;){if(n.name===t||!n.type&&n.jsonType===t)return!0;n=n.type}return!1}function it(e){const{childItemId:t,error:n,filterIsSimpleTypeContraint:s,fullList:o,isActive:l,isLoading:r,items:i,layout:m,onListChange:h,onRetry:p,showIcons:c}=e,T=G(),{collapsed:C}=ce(),{collapsed:y,index:R}=ue(),[L,_]=d.exports.useState(!1);d.exports.useEffect(()=>{if(y)return;const u=setTimeout(()=>{_(!0)},0);return()=>{clearTimeout(u)}},[y]);const S=d.exports.useCallback(u=>{const g=H(u._id),f=t===g;return a(ze,{icon:c===!1?!1:void 0,id:g,pressed:!l&&f,selected:l&&f,layout:m,schemaType:T.get(u._type),value:u})},[t,l,m,T,c]),x=d.exports.useMemo(()=>{if(!L)return null;if(n)return a(D,{align:"center",direction:"column",height:"fill",justify:"center",children:a($,{width:1,children:v(le,{paddingX:4,paddingY:5,space:4,children:[a(de,{as:"h3",children:"Could not fetch list items"}),v(w,{as:"p",children:["Error: ",a("code",{children:n.message})]}),p&&a(j,{children:a(U,{icon:me,onClick:p,text:"Retry",tone:"primary"})})]})})});if(i===null)return a(D,{align:"center",direction:"column",height:"fill",justify:"center",children:a(pe,{ms:300,children:v(fe,{children:[a(he,{muted:!0}),a(j,{marginTop:3,children:a(w,{align:"center",muted:!0,size:1,children:"Loading documents\u2026"})})]})})});if(!r&&i.length===0)return a(D,{align:"center",direction:"column",height:"fill",justify:"center",children:a($,{width:1,children:a(j,{paddingX:4,paddingY:5,children:a(w,{align:"center",muted:!0,size:2,children:s?"No documents of this type":"No matching documents"})})})});const u=o&&i.length===O;return v(j,{padding:2,children:[i.length>0&&a(ye,{gap:1,getItemKey:Qe,items:i,renderItem:S,onChange:h},"".concat(R,"-").concat(y)),r&&a(k,{borderTop:!0,marginTop:1,paddingX:3,paddingY:4,children:a(w,{align:"center",muted:!0,size:1,children:"Loading\u2026"})}),u&&a(k,{marginTop:1,paddingX:3,paddingY:4,radius:2,tone:"transparent",children:v(w,{align:"center",muted:!0,size:1,children:["Displaying a maximum of ",O," documents"]})})]})},[n,s,o,h,r,i,p,S,L,y,R]);return a(ge,{overflow:C?void 0:"auto",children:x})}const Y=d.exports.memo(e=>{let{index:t,initialValueTemplates:n=[],menuItems:s=[],menuItemGroups:o=[],setLayout:l,setSortOrder:r,title:i}=e;const{features:m}=Ie(),h=d.exports.useMemo(()=>({setLayout:p=>{let{layout:c}=p;l(c)},setSortOrder:p=>{r(p)}}),[l,r]);return a(Te,{backButton:m.backButton&&t>0&&a(U,{as:Le,"data-as":"a",icon:xe,mode:"bleed"}),title:i,actions:a(Re,{initialValueTemplateItems:n,actionHandlers:h,menuItemGroups:o,menuItems:s})})});Y.displayName="DocumentListPaneHeader";const ct={result:null,error:!1},ut=e=>({result:{documents:e},loading:!1,error:!1}),lt=e=>({result:null,loading:!1,error:e}),dt=function(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const n=new Se,s=n.next.bind(n);return e.pipe(B(r=>({client:r.client,query:r.query,params:r.params})),Pe(ve),Ce(1),_e()).pipe(be(r=>{const i=we(r.client,r.query,r.params,t).pipe(B(ut),je());return M(F({loading:!0}).pipe(Ee(400),Ae(i)),i)})).pipe(De(ct),Fe((r,i)=>Oe(F(lt(r)),M($e(window,"online"),n).pipe(ke(1),Be(i)))),Me((r,i)=>({...r,...i,onRetry:s})))};function mt(e){var t;const{apiVersion:n,defaultOrdering:s,filter:o,params:l,sortOrder:r}=e,i=qe(),[m,h]=d.exports.useState(!1),p=d.exports.useRef(m),[c,T]=d.exports.useState(null),C=(c==null?void 0:c.error)||null,y=(c==null?void 0:c.loading)||c===null,R=c==null?void 0:c.onRetry,L=c==null||(t=c.result)===null||t===void 0?void 0:t.documents,_=d.exports.useMemo(()=>L?Xe(L):null,[L]),S=d.exports.useMemo(()=>{const u=r==null?void 0:r.extendedProjection,g=["_id","_type"],f=g.join(","),I=s||(r==null?void 0:r.by)||[],b=m?O:N,E=I.length>0?I:V.by,P=tt(E);if(u){const A=g.concat(u).join(",");return["*[".concat(o,"] {").concat(A,"}"),"order(".concat(P,") [0...").concat(b,"]"),"{".concat(f,"}")].join("|")}return"*[".concat(o,"]|order(").concat(P,")[0...").concat(b,"]{").concat(f,"}")},[s,o,m,r]),x=d.exports.useCallback(u=>{let{toIndex:g}=u;y||p.current||g>=N/2&&(h(!0),p.current=!0)},[y]);return d.exports.useEffect(()=>{const u=m?I=>Boolean(I.result):()=>!0;T(I=>I?{...I,loading:!0}:null);const f=dt(F({client:i,query:S,params:l}),{apiVersion:n,tag:"desk.document-list"}).pipe(Ne(u)).subscribe(T);return()=>f.unsubscribe()},[n,i,m,S,l]),d.exports.useEffect(()=>{T(null),h(!1),p.current=!1},[o,l,r,n]),{error:C,fullList:m,handleListChange:x,isLoading:y,items:_,onRetry:R}}const W=[];function pt(e){const t=d.exports.useRef(e);return Ye(t.current,e)||(t.current=e),t.current}const yt=d.exports.memo(function(t){const{childItemId:n,index:s,isActive:o,isSelected:l,pane:r,paneKey:i}=t,m=G(),{name:h}=We(),{defaultLayout:p="default",displayOptions:c,initialValueTemplates:T=W,menuItems:C,menuItemGroups:y,options:R,title:L}=r,{apiVersion:_,defaultOrdering:S=W,filter:x}=R,u=pt(R.params||Ke),g=r.source,f=d.exports.useMemo(()=>Ze(x,u),[x,u]),I=(c==null?void 0:c.showIcons)!==!1,[b,E]=q(f,"layout",p),[P,A]=q(f,"sortOrder",V),z=f&&P?st(P,m.get(f)):P,K=He(z),Q=et(x),{error:X,fullList:J,handleListChange:Z,isLoading:ee,items:te,onRetry:ne}=mt({defaultOrdering:S,filter:x,params:u,sortOrder:K,apiVersion:_});return a(Ge,{name:g||h,children:v(Ue,{currentMaxWidth:350,id:i,maxWidth:640,minWidth:320,selected:l,children:[Ve,a(Y,{index:s,initialValueTemplates:T,menuItems:C,menuItemGroups:y,setLayout:E,setSortOrder:A,title:L}),a(it,{childItemId:n,error:X,filterIsSimpleTypeContraint:Q,fullList:J,isActive:o,isLoading:ee,items:te,layout:b,onListChange:Z,onRetry:ne,showIcons:I})]})})});export{yt as default};
